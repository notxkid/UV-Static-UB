eval(atob("aW1wb3J0U2NyaXB0cygnL3N0YXRpYy91di91di5idW5kbGUuanMnKTsNCmltcG9ydFNjcmlwdHMoJy9zdGF0aWMvdXYvdXYuY29uZmlnLmpzJyk7DQoNCmNsYXNzIFVWU2VydmljZVdvcmtlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7ICAgICANCiAgICBjb25zdHJ1Y3Rvcihjb25maWcgPSBfX3V2JGNvbmZpZykgew0KICAgICAgICBzdXBlcigpOw0KICAgICAgICBpZiAoIWNvbmZpZy5iYXJlKSBjb25maWcuYmFyZSA9ICcvYmFyZS8nOw0KICAgICAgICB0aGlzLmFkZHJlc3NlcyA9IHR5cGVvZiBjb25maWcuYmFyZSA9PT0gJ3N0cmluZycgPyBbIG5ldyBVUkwoY29uZmlnLmJhcmUsIGxvY2F0aW9uKSBdIDogY29uZmlnLmJhcmUubWFwKHN0ciA9PiBuZXcgVVJMKHN0ciwgbG9jYXRpb24pKTsNCiAgICAgICAgdGhpcy5oZWFkZXJzID0gew0KICAgICAgICAgICAgY3NwOiBbDQogICAgICAgICAgICAgICAgJ2Nyb3NzLW9yaWdpbi1lbWJlZGRlci1wb2xpY3knLA0KICAgICAgICAgICAgICAgICdjcm9zcy1vcmlnaW4tb3BlbmVyLXBvbGljeScsDQogICAgICAgICAgICAgICAgJ2Nyb3NzLW9yaWdpbi1yZXNvdXJjZS1wb2xpY3knLA0KICAgICAgICAgICAgICAgICdjb250ZW50LXNlY3VyaXR5LXBvbGljeScsDQogICAgICAgICAgICAgICAgJ2NvbnRlbnQtc2VjdXJpdHktcG9saWN5LXJlcG9ydC1vbmx5JywNCiAgICAgICAgICAgICAgICAnZXhwZWN0LWN0JywNCiAgICAgICAgICAgICAgICAnZmVhdHVyZS1wb2xpY3knLA0KICAgICAgICAgICAgICAgICdvcmlnaW4taXNvbGF0aW9uJywNCiAgICAgICAgICAgICAgICAnc3RyaWN0LXRyYW5zcG9ydC1zZWN1cml0eScsDQogICAgICAgICAgICAgICAgJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnLA0KICAgICAgICAgICAgICAgICd4LWNvbnRlbnQtdHlwZS1vcHRpb25zJywNCiAgICAgICAgICAgICAgICAneC1kb3dubG9hZC1vcHRpb25zJywNCiAgICAgICAgICAgICAgICAneC1mcmFtZS1vcHRpb25zJywNCiAgICAgICAgICAgICAgICAneC1wZXJtaXR0ZWQtY3Jvc3MtZG9tYWluLXBvbGljaWVzJywNCiAgICAgICAgICAgICAgICAneC1wb3dlcmVkLWJ5JywNCiAgICAgICAgICAgICAgICAneC14c3MtcHJvdGVjdGlvbicsDQogICAgICAgICAgICBdLA0KICAgICAgICAgICAgZm9yd2FyZDogWw0KICAgICAgICAgICAgICAgICdhY2NlcHQtZW5jb2RpbmcnLCANCiAgICAgICAgICAgICAgICAnY29ubmVjdGlvbicsDQogICAgICAgICAgICAgICAgJ2NvbnRlbnQtbGVuZ3RoJywNCiAgICAgICAgICAgIF0sDQogICAgICAgIH07DQogICAgICAgIHRoaXMubWV0aG9kID0gew0KICAgICAgICAgICAgZW1wdHk6IFsNCiAgICAgICAgICAgICAgICAnR0VUJywNCiAgICAgICAgICAgICAgICAnSEVBRCcNCiAgICAgICAgICAgIF0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5zdGF0dXNDb2RlID0gew0KICAgICAgICAgICAgZW1wdHk6IFsgDQogICAgICAgICAgICAgICAgMjA0LA0KICAgICAgICAgICAgICAgIDMwNCwNCiAgICAgICAgICAgIF0sDQogICAgICAgIH07ICANCiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7DQogICAgICAgIHRoaXMuYnJvd3NlciA9IFVsdHJhdmlvbGV0LkJvd3Nlci5nZXRQYXJzZXIoc2VsZi5uYXZpZ2F0b3IudXNlckFnZW50KS5nZXRCcm93c2VyTmFtZSgpOw0KDQogICAgICAgIGlmICh0aGlzLmJyb3dzZXIgPT09ICdGaXJlZm94Jykgew0KICAgICAgICAgICAgdGhpcy5oZWFkZXJzLmZvcndhcmQucHVzaCgndXNlci1hZ2VudCcpOw0KICAgICAgICAgICAgdGhpcy5oZWFkZXJzLmZvcndhcmQucHVzaCgnY29udGVudC10eXBlJyk7DQogICAgICAgIH07DQogICAgfTsNCiAgICBhc3luYyBmZXRjaCh7IHJlcXVlc3QgfSkgew0KICAgICAgICBpZiAoIXJlcXVlc3QudXJsLnN0YXJ0c1dpdGgobG9jYXRpb24ub3JpZ2luICsgKHRoaXMuY29uZmlnLnByZWZpeCB8fCAnL3NlcnZpY2UvJykpKSB7DQogICAgICAgICAgICByZXR1cm4gZmV0Y2gocmVxdWVzdCk7DQogICAgICAgIH07DQogICAgICAgIHRyeSB7DQoNCiAgICAgICAgICAgIGNvbnN0IHVsdHJhdmlvbGV0ID0gbmV3IFVsdHJhdmlvbGV0KHRoaXMuY29uZmlnKTsNCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNvbmZpZy5jb25zdHJ1Y3QgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5jb25zdHJ1Y3QodWx0cmF2aW9sZXQsICdzZXJ2aWNlJyk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IHVsdHJhdmlvbGV0LmNvb2tpZS5kYigpOw0KDQogICAgICAgICAgICB1bHRyYXZpb2xldC5tZXRhLm9yaWdpbiA9IGxvY2F0aW9uLm9yaWdpbjsNCiAgICAgICAgICAgIHVsdHJhdmlvbGV0Lm1ldGEuYmFzZSA9IHVsdHJhdmlvbGV0Lm1ldGEudXJsID0gbmV3IFVSTCh1bHRyYXZpb2xldC5zb3VyY2VVcmwocmVxdWVzdC51cmwpKTsNCg0KICAgICAgICAgICAgY29uc3QgcmVxdWVzdEN0eCA9IG5ldyBSZXF1ZXN0Q29udGV4dCgNCiAgICAgICAgICAgICAgICByZXF1ZXN0LCANCiAgICAgICAgICAgICAgICB0aGlzLCANCiAgICAgICAgICAgICAgICB1bHRyYXZpb2xldCwgDQogICAgICAgICAgICAgICAgIXRoaXMubWV0aG9kLmVtcHR5LmluY2x1ZGVzKHJlcXVlc3QubWV0aG9kLnRvVXBwZXJDYXNlKCkpID8gYXdhaXQgcmVxdWVzdC5ibG9iKCkgOiBudWxsDQogICAgICAgICAgICApOw0KDQogICAgICAgICAgICBpZiAodWx0cmF2aW9sZXQubWV0YS51cmwucHJvdG9jb2wgPT09ICdibG9iOicpIHsNCiAgICAgICAgICAgICAgICByZXF1ZXN0Q3R4LmJsb2IgPSB0cnVlOw0KICAgICAgICAgICAgICAgIHJlcXVlc3RDdHguYmFzZSA9IHJlcXVlc3RDdHgudXJsID0gbmV3IFVSTChyZXF1ZXN0Q3R4LnVybC5wYXRobmFtZSk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBpZiAocmVxdWVzdC5yZWZlcnJlciAmJiByZXF1ZXN0LnJlZmVycmVyLnN0YXJ0c1dpdGgobG9jYXRpb24ub3JpZ2luKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlZmVyZXIgPSBuZXcgVVJMKHVsdHJhdmlvbGV0LnNvdXJjZVVybChyZXF1ZXN0LnJlZmVycmVyKSk7DQoNCiAgICAgICAgICAgICAgICBpZiAocmVxdWVzdEN0eC5oZWFkZXJzLm9yaWdpbiB8fCB1bHRyYXZpb2xldC5tZXRhLnVybC5vcmlnaW4gIT09IHJlZmVyZXIub3JpZ2luICYmIHJlcXVlc3QubW9kZSA9PT0gJ2NvcnMnKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RDdHguaGVhZGVycy5vcmlnaW4gPSByZWZlcmVyLm9yaWdpbjsNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgcmVxdWVzdEN0eC5oZWFkZXJzLnJlZmVyZXIgPSByZWZlcmVyLmhyZWY7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCBjb29raWVzID0gYXdhaXQgdWx0cmF2aW9sZXQuY29va2llLmdldENvb2tpZXMoZGIpIHx8IFtdOw0KICAgICAgICAgICAgY29uc3QgY29va2llU3RyID0gdWx0cmF2aW9sZXQuY29va2llLnNlcmlhbGl6ZShjb29raWVzLCB1bHRyYXZpb2xldC5tZXRhLCBmYWxzZSk7DQoNCiAgICAgICAgICAgIGlmICh0aGlzLmJyb3dzZXIgPT09ICdGaXJlZm94JyAmJiAhKHJlcXVlc3QuZGVzdGluYXRpb24gPT09ICdpZnJhbWUnIHx8IHJlcXVlc3QuZGVzdGluYXRpb24gPT09ICdkb2N1bWVudCcpKSB7DQogICAgICAgICAgICAgICAgcmVxdWVzdEN0eC5mb3J3YXJkLnNoaWZ0KCk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBpZiAoY29va2llU3RyKSByZXF1ZXN0Q3R4LmhlYWRlcnMuY29va2llID0gY29va2llU3RyOw0KICAgICAgICAgICAgcmVxdWVzdEN0eC5oZWFkZXJzLkhvc3QgPSByZXF1ZXN0Q3R4LnVybC5ob3N0Ow0KDQoNCiAgICAgICAgICAgIGNvbnN0IHJlcUV2ZW50ID0gbmV3IEhvb2tFdmVudChyZXF1ZXN0Q3R4LCBudWxsLCBudWxsKTsNCiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVxdWVzdCcsIHJlcUV2ZW50KTsNCg0KICAgICAgICAgICAgaWYgKHJlcUV2ZW50LmludGVyY2VwdGVkKSByZXR1cm4gcmVxRXZlbnQucmV0dXJuVmFsdWU7DQoNCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocmVxdWVzdEN0eC5zZW5kKTsNCg0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCcnKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQ3R4ID0gbmV3IFJlc3BvbnNlQ29udGV4dChyZXF1ZXN0Q3R4LCByZXNwb25zZSwgdGhpcyk7DQogICAgICAgICAgICBjb25zdCByZXNFdmVudCA9IG5ldyBIb29rRXZlbnQocmVzcG9uc2VDdHgsIG51bGwsIG51bGwpOw0KDQogICAgICAgICAgICB0aGlzLmVtaXQoJ2JlZm9yZW1vZCcsIHJlc0V2ZW50KTsNCiAgICAgICAgICAgIGlmIChyZXNFdmVudC5pbnRlcmNlcHRlZCkgcmV0dXJuIHJlc0V2ZW50LnJldHVyblZhbHVlOw0KDQogICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgdGhpcy5oZWFkZXJzLmNzcCkgew0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUN0eC5oZWFkZXJzW25hbWVdKSBkZWxldGUgcmVzcG9uc2VDdHguaGVhZGVyc1tuYW1lXTsNCiAgICAgICAgICAgIH07IA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAocmVzcG9uc2VDdHguaGVhZGVycy5sb2NhdGlvbikgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlQ3R4LmhlYWRlcnMubG9jYXRpb24gPSB1bHRyYXZpb2xldC5yZXdyaXRlVXJsKHJlc3BvbnNlQ3R4LmhlYWRlcnMubG9jYXRpb24pOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlQ3R4LmhlYWRlcnNbJ3NldC1jb29raWUnXSkgew0KICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSh1bHRyYXZpb2xldC5jb29raWUuc2V0Q29va2llcyhyZXNwb25zZUN0eC5oZWFkZXJzWydzZXQtY29va2llJ10sIGRiLCB1bHRyYXZpb2xldC5tZXRhKSkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHNlbGYuY2xpZW50cy5tYXRjaEFsbCgpLnRoZW4oZnVuY3Rpb24gKGNsaWVudHMpew0KICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGNsaWVudCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50LnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnOiAndXBkYXRlQ29va2llcycsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdWx0cmF2aW9sZXQubWV0YS51cmwuaHJlZiwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBkZWxldGUgcmVzcG9uc2VDdHguaGVhZGVyc1snc2V0LWNvb2tpZSddOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlQ3R4LmJvZHkpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2gocmVxdWVzdC5kZXN0aW5hdGlvbikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICdzY3JpcHQnOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICd3b3JrZXInOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDdHguYm9keSA9IGBpZiAoIXNlbGYuX191diAmJiBzZWxmLmltcG9ydFNjcmlwdHMpIGltcG9ydFNjcmlwdHMoJyR7X191diRjb25maWcuYnVuZGxlfScsICcke19fdXYkY29uZmlnLmNvbmZpZ30nLCAnJHtfX3V2JGNvbmZpZy5oYW5kbGVyfScpO1xuYDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlQ3R4LmJvZHkgKz0gdWx0cmF2aW9sZXQuanMucmV3cml0ZSgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXNwb25zZS50ZXh0KCkNCiAgICAgICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3R5bGUnOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VDdHguYm9keSA9IHVsdHJhdmlvbGV0LnJld3JpdGVDU1MoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVzcG9uc2UudGV4dCgpDQogICAgICAgICAgICAgICAgICAgICAgICApOyANCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgJ2lmcmFtZSc6DQogICAgICAgICAgICAgICAgY2FzZSAnZG9jdW1lbnQnOg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSHRtbCh1bHRyYXZpb2xldC5tZXRhLnVybCwgKHJlc3BvbnNlQ3R4LmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddIHx8ICcnKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZUN0eC5ib2R5ID0gdWx0cmF2aW9sZXQucmV3cml0ZUh0bWwoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHJlc3BvbnNlLnRleHQoKSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudDogdHJ1ZSAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmplY3RIZWFkOiB1bHRyYXZpb2xldC5jcmVhdGVIdG1sSW5qZWN0KA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmhhbmRsZXIsIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmJ1bmRsZSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcuY29uZmlnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVsdHJhdmlvbGV0LmNvb2tpZS5zZXJpYWxpemUoY29va2llcywgdWx0cmF2aW9sZXQubWV0YSwgdHJ1ZSksIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QucmVmZXJyZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7ICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBpZiAocmVxdWVzdEN0eC5oZWFkZXJzLmFjY2VwdCA9PT0gJ3RleHQvZXZlbnQtc3RyZWFtJykgew0KICAgICAgICAgICAgICAgIHJlc3BvbnNlQ3R4LmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gJ3RleHQvZXZlbnQtc3RyZWFtJzsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVzcG9uc2UnLCByZXNFdmVudCk7DQogICAgICAgICAgICBpZiAocmVzRXZlbnQuaW50ZXJjZXB0ZWQpIHJldHVybiByZXNFdmVudC5yZXR1cm5WYWx1ZTsNCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShyZXNwb25zZUN0eC5ib2R5LCB7DQogICAgICAgICAgICAgICAgaGVhZGVyczogcmVzcG9uc2VDdHguaGVhZGVycywNCiAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlQ3R4LnN0YXR1cywNCiAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZUN0eC5zdGF0dXNUZXh0LA0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgfSBjYXRjaChlcnIpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoZXJyLnRvU3RyaW5nKCksIHsNCiAgICAgICAgICAgICAgICBzdGF0dXM6IDUwMCwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9Ow0KICAgIH07DQogICAgZ2V0QmFyZXJSZXNwb25zZShyZXNwb25zZSkgew0KICAgICAgICBjb25zdCBoZWFkZXJzID0ge307DQogICAgICAgIGNvbnN0IHJhdyA9IEpTT04ucGFyc2UocmVzcG9uc2UuaGVhZGVycy5nZXQoJ3gtYmFyZS1oZWFkZXJzJykpOw0KDQogICAgICAgIGZvciAoY29uc3Qga2V5IGluIHJhdykgew0KICAgICAgICAgICAgaGVhZGVyc1trZXkudG9Mb3dlckNhc2UoKV0gPSByYXdba2V5XTsNCiAgICAgICAgfTsNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgaGVhZGVycywNCiAgICAgICAgICAgIHN0YXR1czogK3Jlc3BvbnNlLmhlYWRlcnMuZ2V0KCd4LWJhcmUtc3RhdHVzJyksDQogICAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5oZWFkZXJzLmdldCgneC1iYXJlLXN0YXR1cy10ZXh0JyksDQogICAgICAgICAgICBib2R5OiAhdGhpcy5zdGF0dXNDb2RlLmVtcHR5LmluY2x1ZGVzKCtyZXNwb25zZS5oZWFkZXJzLmdldCgneC1iYXJlLXN0YXR1cycpKSA/IHJlc3BvbnNlLmJvZHkgOiBudWxsLA0KICAgICAgICB9Ow0KICAgIH07DQogICAgZ2V0IGFkZHJlc3MoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFkZHJlc3Nlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmFkZHJlc3Nlcy5sZW5ndGgpXTsNCiAgICB9Ow0KICAgIHN0YXRpYyBVbHRyYXZpb2xldCA9IFVsdHJhdmlvbGV0Ow0KfTsNCg0Kc2VsZi5VVlNlcnZpY2VXb3JrZXIgPSBVVlNlcnZpY2VXb3JrZXI7DQoNCg0KY2xhc3MgUmVzcG9uc2VDb250ZXh0IHsNCiAgICBjb25zdHJ1Y3RvcihyZXF1ZXN0LCByZXNwb25zZSwgd29ya2VyKSB7DQogICAgICAgIGNvbnN0IHsgaGVhZGVycywgc3RhdHVzLCBzdGF0dXNUZXh0LCBib2R5IH0gPSAhcmVxdWVzdC5ibG9iID8gd29ya2VyLmdldEJhcmVyUmVzcG9uc2UocmVzcG9uc2UpIDogew0KICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsIA0KICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCwNCiAgICAgICAgICAgIGhlYWRlcnM6IE9iamVjdC5mcm9tRW50cmllcyhbLi4ucmVzcG9uc2UuaGVhZGVycy5lbnRyaWVzKCldKSwNCiAgICAgICAgICAgIGJvZHk6IHJlc3BvbnNlLmJvZHksDQogICAgICAgIH07DQogICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7DQogICAgICAgIHRoaXMucmF3ID0gcmVzcG9uc2U7DQogICAgICAgIHRoaXMudWx0cmF2aW9sZXQgPSByZXF1ZXN0LnVsdHJhdmlvbGV0Ow0KICAgICAgICB0aGlzLmhlYWRlcnMgPSBoZWFkZXJzOw0KICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsNCiAgICAgICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzVGV4dDsNCiAgICAgICAgdGhpcy5ib2R5ID0gYm9keTsNCiAgICB9Ow0KICAgIGdldCB1cmwoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QudXJsOw0KICAgIH0NCiAgICBnZXQgYmFzZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdC5iYXNlOw0KICAgIH07DQogICAgc2V0IGJhc2UodmFsKSB7DQogICAgICAgIHRoaXMucmVxdWVzdC5iYXNlID0gdmFsOw0KICAgIH07DQp9Ow0KDQpjbGFzcyBSZXF1ZXN0Q29udGV4dCB7DQogICAgY29uc3RydWN0b3IocmVxdWVzdCwgd29ya2VyLCB1bHRyYXZpb2xldCwgYm9keSA9IG51bGwpIHsNCiAgICAgICAgdGhpcy51bHRyYXZpb2xldCA9IHVsdHJhdmlvbGV0Ow0KICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0Ow0KICAgICAgICB0aGlzLmhlYWRlcnMgPSBPYmplY3QuZnJvbUVudHJpZXMoWy4uLnJlcXVlc3QuaGVhZGVycy5lbnRyaWVzKCldKTsNCiAgICAgICAgdGhpcy5tZXRob2QgPSByZXF1ZXN0Lm1ldGhvZDsNCiAgICAgICAgdGhpcy5mb3J3YXJkID0gWy4uLndvcmtlci5oZWFkZXJzLmZvcndhcmRdOw0KICAgICAgICB0aGlzLmFkZHJlc3MgPSB3b3JrZXIuYWRkcmVzczsNCiAgICAgICAgdGhpcy5ib2R5ID0gYm9keSB8fCBudWxsOw0KICAgICAgICB0aGlzLnJlZGlyZWN0ID0gcmVxdWVzdC5yZWRpcmVjdDsNCiAgICAgICAgdGhpcy5jcmVkZW50aWFscyA9ICdvbWl0JzsNCiAgICAgICAgdGhpcy5tb2RlID0gcmVxdWVzdC5tb2RlID09PSAnY29ycycgPyByZXF1ZXN0Lm1vZGUgOiAnc2FtZS1vcmlnaW4nOw0KICAgICAgICB0aGlzLmJsb2IgPSBmYWxzZTsNCiAgICB9Ow0KICAgIGdldCBzZW5kKCkgew0KICAgICAgICByZXR1cm4gbmV3IFJlcXVlc3QoKCF0aGlzLmJsb2IgPyB0aGlzLmFkZHJlc3MuaHJlZiArICd2MS8nIDogJ2Jsb2I6JyArIGxvY2F0aW9uLm9yaWdpbiArIHRoaXMudXJsLnBhdGhuYW1lKSwgew0KICAgICAgICAgICAgbWV0aG9kOiB0aGlzLm1ldGhvZCwNCiAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAneC1iYXJlLXByb3RvY29sJzogdGhpcy51cmwucHJvdG9jb2wsDQogICAgICAgICAgICAgICAgJ3gtYmFyZS1ob3N0JzogdGhpcy51cmwuaG9zdG5hbWUsDQogICAgICAgICAgICAgICAgJ3gtYmFyZS1wYXRoJzogdGhpcy51cmwucGF0aG5hbWUgKyB0aGlzLnVybC5zZWFyY2gsDQogICAgICAgICAgICAgICAgJ3gtYmFyZS1wb3J0JzogdGhpcy51cmwucG9ydCB8fCAodGhpcy51cmwucHJvdG9jb2wgPT09ICdodHRwczonID8gJzQ0MycgOiAnODAnKSwNCiAgICAgICAgICAgICAgICAneC1iYXJlLWhlYWRlcnMnOiBKU09OLnN0cmluZ2lmeSh0aGlzLmhlYWRlcnMpLA0KICAgICAgICAgICAgICAgICd4LWJhcmUtZm9yd2FyZC1oZWFkZXJzJzogSlNPTi5zdHJpbmdpZnkodGhpcy5mb3J3YXJkKSwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICByZWRpcmVjdDogdGhpcy5yZWRpcmVjdCwNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiB0aGlzLmNyZWRlbnRpYWxzLA0KICAgICAgICAgICAgbW9kZTogbG9jYXRpb24ub3JpZ2luICE9PSB0aGlzLmFkZHJlc3Mub3JpZ2luID8gJ2NvcnMnIDogdGhpcy5tb2RlLA0KICAgICAgICAgICAgYm9keTogdGhpcy5ib2R5DQogICAgICAgIH0pOw0KICAgIH07DQogICAgZ2V0IHVybCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudWx0cmF2aW9sZXQubWV0YS51cmw7DQogICAgfTsNCiAgICBzZXQgdXJsKHZhbCkgew0KICAgICAgICB0aGlzLnVsdHJhdmlvbGV0Lm1ldGEudXJsID0gdmFsOw0KICAgIH07DQogICAgZ2V0IGJhc2UoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnVsdHJhdmlvbGV0Lm1ldGEuYmFzZTsNCiAgICB9Ow0KICAgIHNldCBiYXNlKHZhbCkgew0KICAgICAgICB0aGlzLnVsdHJhdmlvbGV0Lm1ldGEuYmFzZSA9IHZhbDsNCiAgICB9Ow0KfQ0KDQpmdW5jdGlvbiBpc0h0bWwodXJsLCBjb250ZW50VHlwZSA9ICcnKSB7DQogICAgcmV0dXJuIChVbHRyYXZpb2xldC5taW1lLmNvbnRlbnRUeXBlKChjb250ZW50VHlwZSAgfHwgdXJsLnBhdGhuYW1lKSkgfHwgJ3RleHQvaHRtbCcpLnNwbGl0KCc7JylbMF0gPT09ICd0ZXh0L2h0bWwnOw0KfTsNCg0KY2xhc3MgSG9va0V2ZW50IHsNCiAgICAjaW50ZXJjZXB0ZWQ7DQogICAgI3JldHVyblZhbHVlOw0KICAgIGNvbnN0cnVjdG9yKGRhdGEgPSB7fSwgdGFyZ2V0ID0gbnVsbCwgdGhhdCA9IG51bGwpIHsNCiAgICAgICAgdGhpcy4jaW50ZXJjZXB0ZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy4jcmV0dXJuVmFsdWUgPSBudWxsOw0KICAgICAgICB0aGlzLmRhdGEgPSBkYXRhOw0KICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsNCiAgICAgICAgdGhpcy50aGF0ID0gdGhhdDsNCiAgICB9Ow0KICAgIGdldCBpbnRlcmNlcHRlZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuI2ludGVyY2VwdGVkOw0KICAgIH07DQogICAgZ2V0IHJldHVyblZhbHVlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy4jcmV0dXJuVmFsdWU7DQogICAgfTsNCiAgICByZXNwb25kV2l0aChpbnB1dCkgew0KICAgICAgICB0aGlzLiNyZXR1cm5WYWx1ZSA9IGlucHV0Ow0KICAgICAgICB0aGlzLiNpbnRlcmNlcHRlZCA9IHRydWU7DQogICAgfTsNCn07ICANCg0KdmFyIFIgPSB0eXBlb2YgUmVmbGVjdCA9PT0gJ29iamVjdCcgPyBSZWZsZWN0IDogbnVsbA0KdmFyIFJlZmxlY3RBcHBseSA9IFIgJiYgdHlwZW9mIFIuYXBwbHkgPT09ICdmdW5jdGlvbicNCiAgPyBSLmFwcGx5DQogIDogZnVuY3Rpb24gUmVmbGVjdEFwcGx5KHRhcmdldCwgcmVjZWl2ZXIsIGFyZ3MpIHsNCiAgICByZXR1cm4gRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LmNhbGwodGFyZ2V0LCByZWNlaXZlciwgYXJncyk7DQogIH0NCg0KdmFyIFJlZmxlY3RPd25LZXlzDQppZiAoUiAmJiB0eXBlb2YgUi5vd25LZXlzID09PSAnZnVuY3Rpb24nKSB7DQogIFJlZmxlY3RPd25LZXlzID0gUi5vd25LZXlzDQp9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsNCiAgUmVmbGVjdE93bktleXMgPSBmdW5jdGlvbiBSZWZsZWN0T3duS2V5cyh0YXJnZXQpIHsNCiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGFyZ2V0KQ0KICAgICAgLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHRhcmdldCkpOw0KICB9Ow0KfSBlbHNlIHsNCiAgUmVmbGVjdE93bktleXMgPSBmdW5jdGlvbiBSZWZsZWN0T3duS2V5cyh0YXJnZXQpIHsNCiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGFyZ2V0KTsNCiAgfTsNCn0NCg0KZnVuY3Rpb24gUHJvY2Vzc0VtaXRXYXJuaW5nKHdhcm5pbmcpIHsNCiAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS53YXJuKSBjb25zb2xlLndhcm4od2FybmluZyk7DQp9DQoNCnZhciBOdW1iZXJJc05hTiA9IE51bWJlci5pc05hTiB8fCBmdW5jdGlvbiBOdW1iZXJJc05hTih2YWx1ZSkgew0KICByZXR1cm4gdmFsdWUgIT09IHZhbHVlOw0KfQ0KDQpmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7DQogIEV2ZW50RW1pdHRlci5pbml0LmNhbGwodGhpcyk7DQp9DQoNCi8vIEJhY2t3YXJkcy1jb21wYXQgd2l0aCBub2RlIDAuMTAueA0KRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjsNCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzID0gdW5kZWZpbmVkOw0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fZXZlbnRzQ291bnQgPSAwOw0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5fbWF4TGlzdGVuZXJzID0gdW5kZWZpbmVkOw0KDQovLyBCeSBkZWZhdWx0IEV2ZW50RW1pdHRlcnMgd2lsbCBwcmludCBhIHdhcm5pbmcgaWYgbW9yZSB0aGFuIDEwIGxpc3RlbmVycyBhcmUNCi8vIGFkZGVkIHRvIGl0LiBUaGlzIGlzIGEgdXNlZnVsIGRlZmF1bHQgd2hpY2ggaGVscHMgZmluZGluZyBtZW1vcnkgbGVha3MuDQp2YXIgZGVmYXVsdE1heExpc3RlbmVycyA9IDEwOw0KDQpmdW5jdGlvbiBjaGVja0xpc3RlbmVyKGxpc3RlbmVyKSB7DQogIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHsNCiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgImxpc3RlbmVyIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgRnVuY3Rpb24uIFJlY2VpdmVkIHR5cGUgJyArIHR5cGVvZiBsaXN0ZW5lcik7DQogIH0NCn0NCg0KT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlciwgJ2RlZmF1bHRNYXhMaXN0ZW5lcnMnLCB7DQogIGVudW1lcmFibGU6IHRydWUsDQogIGdldDogZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIGRlZmF1bHRNYXhMaXN0ZW5lcnM7DQogIH0sDQogIHNldDogZnVuY3Rpb24oYXJnKSB7DQogICAgaWYgKHR5cGVvZiBhcmcgIT09ICdudW1iZXInIHx8IGFyZyA8IDAgfHwgTnVtYmVySXNOYU4oYXJnKSkgew0KICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoJ1RoZSB2YWx1ZSBvZiAiZGVmYXVsdE1heExpc3RlbmVycyIgaXMgb3V0IG9mIHJhbmdlLiBJdCBtdXN0IGJlIGEgbm9uLW5lZ2F0aXZlIG51bWJlci4gUmVjZWl2ZWQgJyArIGFyZyArICcuJyk7DQogICAgfQ0KICAgIGRlZmF1bHRNYXhMaXN0ZW5lcnMgPSBhcmc7DQogIH0NCn0pOw0KDQpFdmVudEVtaXR0ZXIuaW5pdCA9IGZ1bmN0aW9uKCkgew0KDQogIGlmICh0aGlzLl9ldmVudHMgPT09IHVuZGVmaW5lZCB8fA0KICAgICAgdGhpcy5fZXZlbnRzID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuX2V2ZW50cykgew0KICAgIHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwOw0KICB9DQoNCiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gdGhpcy5fbWF4TGlzdGVuZXJzIHx8IHVuZGVmaW5lZDsNCn07DQoNCi8vIE9idmlvdXNseSBub3QgYWxsIEVtaXR0ZXJzIHNob3VsZCBiZSBsaW1pdGVkIHRvIDEwLiBUaGlzIGZ1bmN0aW9uIGFsbG93cw0KLy8gdGhhdCB0byBiZSBpbmNyZWFzZWQuIFNldCB0byB6ZXJvIGZvciB1bmxpbWl0ZWQuDQpFdmVudEVtaXR0ZXIucHJvdG90eXBlLnNldE1heExpc3RlbmVycyA9IGZ1bmN0aW9uIHNldE1heExpc3RlbmVycyhuKSB7DQogIGlmICh0eXBlb2YgbiAhPT0gJ251bWJlcicgfHwgbiA8IDAgfHwgTnVtYmVySXNOYU4obikpIHsNCiAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcignVGhlIHZhbHVlIG9mICJuIiBpcyBvdXQgb2YgcmFuZ2UuIEl0IG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyLiBSZWNlaXZlZCAnICsgbiArICcuJyk7DQogIH0NCiAgdGhpcy5fbWF4TGlzdGVuZXJzID0gbjsNCiAgcmV0dXJuIHRoaXM7DQp9Ow0KDQpmdW5jdGlvbiBfZ2V0TWF4TGlzdGVuZXJzKHRoYXQpIHsNCiAgaWYgKHRoYXQuX21heExpc3RlbmVycyA9PT0gdW5kZWZpbmVkKQ0KICAgIHJldHVybiBFdmVudEVtaXR0ZXIuZGVmYXVsdE1heExpc3RlbmVyczsNCiAgcmV0dXJuIHRoYXQuX21heExpc3RlbmVyczsNCn0NCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5nZXRNYXhMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRNYXhMaXN0ZW5lcnMoKSB7DQogIHJldHVybiBfZ2V0TWF4TGlzdGVuZXJzKHRoaXMpOw0KfTsNCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdCh0eXBlKSB7DQogIHZhciBhcmdzID0gW107DQogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsNCiAgdmFyIGRvRXJyb3IgPSAodHlwZSA9PT0gJ2Vycm9yJyk7DQoNCiAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50czsNCiAgaWYgKGV2ZW50cyAhPT0gdW5kZWZpbmVkKQ0KICAgIGRvRXJyb3IgPSAoZG9FcnJvciAmJiBldmVudHMuZXJyb3IgPT09IHVuZGVmaW5lZCk7DQogIGVsc2UgaWYgKCFkb0Vycm9yKQ0KICAgIHJldHVybiBmYWxzZTsNCg0KICAvLyBJZiB0aGVyZSBpcyBubyAnZXJyb3InIGV2ZW50IGxpc3RlbmVyIHRoZW4gdGhyb3cuDQogIGlmIChkb0Vycm9yKSB7DQogICAgdmFyIGVyOw0KICAgIGlmIChhcmdzLmxlbmd0aCA+IDApDQogICAgICBlciA9IGFyZ3NbMF07DQogICAgaWYgKGVyIGluc3RhbmNlb2YgRXJyb3IpIHsNCiAgICAgIC8vIE5vdGU6IFRoZSBjb21tZW50cyBvbiB0aGUgYHRocm93YCBsaW5lcyBhcmUgaW50ZW50aW9uYWwsIHRoZXkgc2hvdw0KICAgICAgLy8gdXAgaW4gTm9kZSdzIG91dHB1dCBpZiB0aGlzIHJlc3VsdHMgaW4gYW4gdW5oYW5kbGVkIGV4Y2VwdGlvbi4NCiAgICAgIHRocm93IGVyOyAvLyBVbmhhbmRsZWQgJ2Vycm9yJyBldmVudA0KICAgIH0NCiAgICAvLyBBdCBsZWFzdCBnaXZlIHNvbWUga2luZCBvZiBjb250ZXh0IHRvIHRoZSB1c2VyDQogICAgdmFyIGVyciA9IG5ldyBFcnJvcignVW5oYW5kbGVkIGVycm9yLicgKyAoZXIgPyAnICgnICsgZXIubWVzc2FnZSArICcpJyA6ICcnKSk7DQogICAgZXJyLmNvbnRleHQgPSBlcjsNCiAgICB0aHJvdyBlcnI7IC8vIFVuaGFuZGxlZCAnZXJyb3InIGV2ZW50DQogIH0NCg0KICB2YXIgaGFuZGxlciA9IGV2ZW50c1t0eXBlXTsNCg0KICBpZiAoaGFuZGxlciA9PT0gdW5kZWZpbmVkKQ0KICAgIHJldHVybiBmYWxzZTsNCg0KICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHsNCiAgICBSZWZsZWN0QXBwbHkoaGFuZGxlciwgdGhpcywgYXJncyk7DQogIH0gZWxzZSB7DQogICAgdmFyIGxlbiA9IGhhbmRsZXIubGVuZ3RoOw0KICAgIHZhciBsaXN0ZW5lcnMgPSBhcnJheUNsb25lKGhhbmRsZXIsIGxlbik7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkNCiAgICAgIFJlZmxlY3RBcHBseShsaXN0ZW5lcnNbaV0sIHRoaXMsIGFyZ3MpOw0KICB9DQoNCiAgcmV0dXJuIHRydWU7DQp9Ow0KDQpmdW5jdGlvbiBfYWRkTGlzdGVuZXIodGFyZ2V0LCB0eXBlLCBsaXN0ZW5lciwgcHJlcGVuZCkgew0KICB2YXIgbTsNCiAgdmFyIGV2ZW50czsNCiAgdmFyIGV4aXN0aW5nOw0KDQogIGNoZWNrTGlzdGVuZXIobGlzdGVuZXIpOw0KDQogIGV2ZW50cyA9IHRhcmdldC5fZXZlbnRzOw0KICBpZiAoZXZlbnRzID09PSB1bmRlZmluZWQpIHsNCiAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgdGFyZ2V0Ll9ldmVudHNDb3VudCA9IDA7DQogIH0gZWxzZSB7DQogICAgLy8gVG8gYXZvaWQgcmVjdXJzaW9uIGluIHRoZSBjYXNlIHRoYXQgdHlwZSA9PT0gIm5ld0xpc3RlbmVyIiEgQmVmb3JlDQogICAgLy8gYWRkaW5nIGl0IHRvIHRoZSBsaXN0ZW5lcnMsIGZpcnN0IGVtaXQgIm5ld0xpc3RlbmVyIi4NCiAgICBpZiAoZXZlbnRzLm5ld0xpc3RlbmVyICE9PSB1bmRlZmluZWQpIHsNCiAgICAgIHRhcmdldC5lbWl0KCduZXdMaXN0ZW5lcicsIHR5cGUsDQogICAgICAgICAgICAgICAgICBsaXN0ZW5lci5saXN0ZW5lciA/IGxpc3RlbmVyLmxpc3RlbmVyIDogbGlzdGVuZXIpOw0KDQogICAgICAvLyBSZS1hc3NpZ24gYGV2ZW50c2AgYmVjYXVzZSBhIG5ld0xpc3RlbmVyIGhhbmRsZXIgY291bGQgaGF2ZSBjYXVzZWQgdGhlDQogICAgICAvLyB0aGlzLl9ldmVudHMgdG8gYmUgYXNzaWduZWQgdG8gYSBuZXcgb2JqZWN0DQogICAgICBldmVudHMgPSB0YXJnZXQuX2V2ZW50czsNCiAgICB9DQogICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV07DQogIH0NCg0KICBpZiAoZXhpc3RpbmcgPT09IHVuZGVmaW5lZCkgew0KICAgIC8vIE9wdGltaXplIHRoZSBjYXNlIG9mIG9uZSBsaXN0ZW5lci4gRG9uJ3QgbmVlZCB0aGUgZXh0cmEgYXJyYXkgb2JqZWN0Lg0KICAgIGV4aXN0aW5nID0gZXZlbnRzW3R5cGVdID0gbGlzdGVuZXI7DQogICAgKyt0YXJnZXQuX2V2ZW50c0NvdW50Ow0KICB9IGVsc2Ugew0KICAgIGlmICh0eXBlb2YgZXhpc3RpbmcgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIC8vIEFkZGluZyB0aGUgc2Vjb25kIGVsZW1lbnQsIG5lZWQgdG8gY2hhbmdlIHRvIGFycmF5Lg0KICAgICAgZXhpc3RpbmcgPSBldmVudHNbdHlwZV0gPQ0KICAgICAgICBwcmVwZW5kID8gW2xpc3RlbmVyLCBleGlzdGluZ10gOiBbZXhpc3RpbmcsIGxpc3RlbmVyXTsNCiAgICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgZ290IGFuIGFycmF5LCBqdXN0IGFwcGVuZC4NCiAgICB9IGVsc2UgaWYgKHByZXBlbmQpIHsNCiAgICAgIGV4aXN0aW5nLnVuc2hpZnQobGlzdGVuZXIpOw0KICAgIH0gZWxzZSB7DQogICAgICBleGlzdGluZy5wdXNoKGxpc3RlbmVyKTsNCiAgICB9DQoNCiAgICAvLyBDaGVjayBmb3IgbGlzdGVuZXIgbGVhaw0KICAgIG0gPSBfZ2V0TWF4TGlzdGVuZXJzKHRhcmdldCk7DQogICAgaWYgKG0gPiAwICYmIGV4aXN0aW5nLmxlbmd0aCA+IG0gJiYgIWV4aXN0aW5nLndhcm5lZCkgew0KICAgICAgZXhpc3Rpbmcud2FybmVkID0gdHJ1ZTsNCiAgICAgIC8vIE5vIGVycm9yIGNvZGUgZm9yIHRoaXMgc2luY2UgaXQgaXMgYSBXYXJuaW5nDQogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXgNCiAgICAgIHZhciB3ID0gbmV3IEVycm9yKCdQb3NzaWJsZSBFdmVudEVtaXR0ZXIgbWVtb3J5IGxlYWsgZGV0ZWN0ZWQuICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZy5sZW5ndGggKyAnICcgKyBTdHJpbmcodHlwZSkgKyAnIGxpc3RlbmVycyAnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZGVkLiBVc2UgZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoKSB0byAnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2luY3JlYXNlIGxpbWl0Jyk7DQogICAgICB3Lm5hbWUgPSAnTWF4TGlzdGVuZXJzRXhjZWVkZWRXYXJuaW5nJzsNCiAgICAgIHcuZW1pdHRlciA9IHRhcmdldDsNCiAgICAgIHcudHlwZSA9IHR5cGU7DQogICAgICB3LmNvdW50ID0gZXhpc3RpbmcubGVuZ3RoOw0KICAgICAgUHJvY2Vzc0VtaXRXYXJuaW5nKHcpOw0KICAgIH0NCiAgfQ0KDQogIHJldHVybiB0YXJnZXQ7DQp9DQoNCkV2ZW50RW1pdHRlci5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgew0KICByZXR1cm4gX2FkZExpc3RlbmVyKHRoaXMsIHR5cGUsIGxpc3RlbmVyLCBmYWxzZSk7DQp9Ow0KDQpFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGRMaXN0ZW5lcjsNCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kTGlzdGVuZXIgPQ0KICAgIGZ1bmN0aW9uIHByZXBlbmRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgew0KICAgICAgcmV0dXJuIF9hZGRMaXN0ZW5lcih0aGlzLCB0eXBlLCBsaXN0ZW5lciwgdHJ1ZSk7DQogICAgfTsNCg0KZnVuY3Rpb24gb25jZVdyYXBwZXIoKSB7DQogIGlmICghdGhpcy5maXJlZCkgew0KICAgIHRoaXMudGFyZ2V0LnJlbW92ZUxpc3RlbmVyKHRoaXMudHlwZSwgdGhpcy53cmFwRm4pOw0KICAgIHRoaXMuZmlyZWQgPSB0cnVlOw0KICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKQ0KICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuY2FsbCh0aGlzLnRhcmdldCk7DQogICAgcmV0dXJuIHRoaXMubGlzdGVuZXIuYXBwbHkodGhpcy50YXJnZXQsIGFyZ3VtZW50cyk7DQogIH0NCn0NCg0KZnVuY3Rpb24gX29uY2VXcmFwKHRhcmdldCwgdHlwZSwgbGlzdGVuZXIpIHsNCiAgdmFyIHN0YXRlID0geyBmaXJlZDogZmFsc2UsIHdyYXBGbjogdW5kZWZpbmVkLCB0YXJnZXQ6IHRhcmdldCwgdHlwZTogdHlwZSwgbGlzdGVuZXI6IGxpc3RlbmVyIH07DQogIHZhciB3cmFwcGVkID0gb25jZVdyYXBwZXIuYmluZChzdGF0ZSk7DQogIHdyYXBwZWQubGlzdGVuZXIgPSBsaXN0ZW5lcjsNCiAgc3RhdGUud3JhcEZuID0gd3JhcHBlZDsNCiAgcmV0dXJuIHdyYXBwZWQ7DQp9DQoNCkV2ZW50RW1pdHRlci5wcm90b3R5cGUub25jZSA9IGZ1bmN0aW9uIG9uY2UodHlwZSwgbGlzdGVuZXIpIHsNCiAgY2hlY2tMaXN0ZW5lcihsaXN0ZW5lcik7DQogIHRoaXMub24odHlwZSwgX29uY2VXcmFwKHRoaXMsIHR5cGUsIGxpc3RlbmVyKSk7DQogIHJldHVybiB0aGlzOw0KfTsNCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5wcmVwZW5kT25jZUxpc3RlbmVyID0NCiAgICBmdW5jdGlvbiBwcmVwZW5kT25jZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7DQogICAgICBjaGVja0xpc3RlbmVyKGxpc3RlbmVyKTsNCiAgICAgIHRoaXMucHJlcGVuZExpc3RlbmVyKHR5cGUsIF9vbmNlV3JhcCh0aGlzLCB0eXBlLCBsaXN0ZW5lcikpOw0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KLy8gRW1pdHMgYSAncmVtb3ZlTGlzdGVuZXInIGV2ZW50IGlmIGFuZCBvbmx5IGlmIHRoZSBsaXN0ZW5lciB3YXMgcmVtb3ZlZC4NCkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPQ0KICAgIGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7DQogICAgICB2YXIgbGlzdCwgZXZlbnRzLCBwb3NpdGlvbiwgaSwgb3JpZ2luYWxMaXN0ZW5lcjsNCg0KICAgICAgY2hlY2tMaXN0ZW5lcihsaXN0ZW5lcik7DQoNCiAgICAgIGV2ZW50cyA9IHRoaXMuX2V2ZW50czsNCiAgICAgIGlmIChldmVudHMgPT09IHVuZGVmaW5lZCkNCiAgICAgICAgcmV0dXJuIHRoaXM7DQoNCiAgICAgIGxpc3QgPSBldmVudHNbdHlwZV07DQogICAgICBpZiAobGlzdCA9PT0gdW5kZWZpbmVkKQ0KICAgICAgICByZXR1cm4gdGhpczsNCg0KICAgICAgaWYgKGxpc3QgPT09IGxpc3RlbmVyIHx8IGxpc3QubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7DQogICAgICAgIGlmICgtLXRoaXMuX2V2ZW50c0NvdW50ID09PSAwKQ0KICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIGRlbGV0ZSBldmVudHNbdHlwZV07DQogICAgICAgICAgaWYgKGV2ZW50cy5yZW1vdmVMaXN0ZW5lcikNCiAgICAgICAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBsaXN0Lmxpc3RlbmVyIHx8IGxpc3RlbmVyKTsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbGlzdCAhPT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICBwb3NpdGlvbiA9IC0xOw0KDQogICAgICAgIGZvciAoaSA9IGxpc3QubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gbGlzdGVuZXIgfHwgbGlzdFtpXS5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHsNCiAgICAgICAgICAgIG9yaWdpbmFsTGlzdGVuZXIgPSBsaXN0W2ldLmxpc3RlbmVyOw0KICAgICAgICAgICAgcG9zaXRpb24gPSBpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkNCiAgICAgICAgICByZXR1cm4gdGhpczsNCg0KICAgICAgICBpZiAocG9zaXRpb24gPT09IDApDQogICAgICAgICAgbGlzdC5zaGlmdCgpOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICBzcGxpY2VPbmUobGlzdCwgcG9zaXRpb24pOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID09PSAxKQ0KICAgICAgICAgIGV2ZW50c1t0eXBlXSA9IGxpc3RbMF07DQoNCiAgICAgICAgaWYgKGV2ZW50cy5yZW1vdmVMaXN0ZW5lciAhPT0gdW5kZWZpbmVkKQ0KICAgICAgICAgIHRoaXMuZW1pdCgncmVtb3ZlTGlzdGVuZXInLCB0eXBlLCBvcmlnaW5hbExpc3RlbmVyIHx8IGxpc3RlbmVyKTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vZmYgPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyOw0KDQpFdmVudEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9DQogICAgZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzKHR5cGUpIHsNCiAgICAgIHZhciBsaXN0ZW5lcnMsIGV2ZW50cywgaTsNCg0KICAgICAgZXZlbnRzID0gdGhpcy5fZXZlbnRzOw0KICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKQ0KICAgICAgICByZXR1cm4gdGhpczsNCg0KICAgICAgLy8gbm90IGxpc3RlbmluZyBmb3IgcmVtb3ZlTGlzdGVuZXIsIG5vIG5lZWQgdG8gZW1pdA0KICAgICAgaWYgKGV2ZW50cy5yZW1vdmVMaXN0ZW5lciA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgdGhpcy5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCiAgICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7DQogICAgICAgIH0gZWxzZSBpZiAoZXZlbnRzW3R5cGVdICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICBpZiAoLS10aGlzLl9ldmVudHNDb3VudCA9PT0gMCkNCiAgICAgICAgICAgIHRoaXMuX2V2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7DQogICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgZGVsZXRlIGV2ZW50c1t0eXBlXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgIH0NCg0KICAgICAgLy8gZW1pdCByZW1vdmVMaXN0ZW5lciBmb3IgYWxsIGxpc3RlbmVycyBvbiBhbGwgZXZlbnRzDQogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGV2ZW50cyk7DQogICAgICAgIHZhciBrZXk7DQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAga2V5ID0ga2V5c1tpXTsNCiAgICAgICAgICBpZiAoa2V5ID09PSAncmVtb3ZlTGlzdGVuZXInKSBjb250aW51ZTsNCiAgICAgICAgICB0aGlzLnJlbW92ZUFsbExpc3RlbmVycyhrZXkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCdyZW1vdmVMaXN0ZW5lcicpOw0KICAgICAgICB0aGlzLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOw0KICAgICAgICB0aGlzLl9ldmVudHNDb3VudCA9IDA7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KDQogICAgICBsaXN0ZW5lcnMgPSBldmVudHNbdHlwZV07DQoNCiAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXJzID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHRoaXMucmVtb3ZlTGlzdGVuZXIodHlwZSwgbGlzdGVuZXJzKTsNCiAgICAgIH0gZWxzZSBpZiAobGlzdGVuZXJzICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgLy8gTElGTyBvcmRlcg0KICAgICAgICBmb3IgKGkgPSBsaXN0ZW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCiAgICAgICAgICB0aGlzLnJlbW92ZUxpc3RlbmVyKHR5cGUsIGxpc3RlbmVyc1tpXSk7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KZnVuY3Rpb24gX2xpc3RlbmVycyh0YXJnZXQsIHR5cGUsIHVud3JhcCkgew0KICB2YXIgZXZlbnRzID0gdGFyZ2V0Ll9ldmVudHM7DQoNCiAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKQ0KICAgIHJldHVybiBbXTsNCg0KICB2YXIgZXZsaXN0ZW5lciA9IGV2ZW50c1t0eXBlXTsNCiAgaWYgKGV2bGlzdGVuZXIgPT09IHVuZGVmaW5lZCkNCiAgICByZXR1cm4gW107DQoNCiAgaWYgKHR5cGVvZiBldmxpc3RlbmVyID09PSAnZnVuY3Rpb24nKQ0KICAgIHJldHVybiB1bndyYXAgPyBbZXZsaXN0ZW5lci5saXN0ZW5lciB8fCBldmxpc3RlbmVyXSA6IFtldmxpc3RlbmVyXTsNCg0KICByZXR1cm4gdW53cmFwID8NCiAgICB1bndyYXBMaXN0ZW5lcnMoZXZsaXN0ZW5lcikgOiBhcnJheUNsb25lKGV2bGlzdGVuZXIsIGV2bGlzdGVuZXIubGVuZ3RoKTsNCn0NCg0KRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiBsaXN0ZW5lcnModHlwZSkgew0KICByZXR1cm4gX2xpc3RlbmVycyh0aGlzLCB0eXBlLCB0cnVlKTsNCn07DQoNCkV2ZW50RW1pdHRlci5wcm90b3R5cGUucmF3TGlzdGVuZXJzID0gZnVuY3Rpb24gcmF3TGlzdGVuZXJzKHR5cGUpIHsNCiAgcmV0dXJuIF9saXN0ZW5lcnModGhpcywgdHlwZSwgZmFsc2UpOw0KfTsNCg0KRXZlbnRFbWl0dGVyLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7DQogIGlmICh0eXBlb2YgZW1pdHRlci5saXN0ZW5lckNvdW50ID09PSAnZnVuY3Rpb24nKSB7DQogICAgcmV0dXJuIGVtaXR0ZXIubGlzdGVuZXJDb3VudCh0eXBlKTsNCiAgfSBlbHNlIHsNCiAgICByZXR1cm4gbGlzdGVuZXJDb3VudC5jYWxsKGVtaXR0ZXIsIHR5cGUpOw0KICB9DQp9Ow0KDQpFdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBsaXN0ZW5lckNvdW50Ow0KZnVuY3Rpb24gbGlzdGVuZXJDb3VudCh0eXBlKSB7DQogIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHM7DQoNCiAgaWYgKGV2ZW50cyAhPT0gdW5kZWZpbmVkKSB7DQogICAgdmFyIGV2bGlzdGVuZXIgPSBldmVudHNbdHlwZV07DQoNCiAgICBpZiAodHlwZW9mIGV2bGlzdGVuZXIgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgIHJldHVybiAxOw0KICAgIH0gZWxzZSBpZiAoZXZsaXN0ZW5lciAhPT0gdW5kZWZpbmVkKSB7DQogICAgICByZXR1cm4gZXZsaXN0ZW5lci5sZW5ndGg7DQogICAgfQ0KICB9DQoNCiAgcmV0dXJuIDA7DQp9DQoNCkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7DQogIHJldHVybiB0aGlzLl9ldmVudHNDb3VudCA+IDAgPyBSZWZsZWN0T3duS2V5cyh0aGlzLl9ldmVudHMpIDogW107DQp9Ow0KDQpmdW5jdGlvbiBhcnJheUNsb25lKGFyciwgbikgew0KICB2YXIgY29weSA9IG5ldyBBcnJheShuKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpDQogICAgY29weVtpXSA9IGFycltpXTsNCiAgcmV0dXJuIGNvcHk7DQp9DQoNCmZ1bmN0aW9uIHNwbGljZU9uZShsaXN0LCBpbmRleCkgew0KICBmb3IgKDsgaW5kZXggKyAxIDwgbGlzdC5sZW5ndGg7IGluZGV4KyspDQogICAgbGlzdFtpbmRleF0gPSBsaXN0W2luZGV4ICsgMV07DQogIGxpc3QucG9wKCk7DQp9DQoNCmZ1bmN0aW9uIHVud3JhcExpc3RlbmVycyhhcnIpIHsNCiAgdmFyIHJldCA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXQubGVuZ3RoOyArK2kpIHsNCiAgICByZXRbaV0gPSBhcnJbaV0ubGlzdGVuZXIgfHwgYXJyW2ldOw0KICB9DQogIHJldHVybiByZXQ7DQp9DQoNCmZ1bmN0aW9uIG9uY2UoZW1pdHRlciwgbmFtZSkgew0KICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgew0KICAgIGZ1bmN0aW9uIGVycm9yTGlzdGVuZXIoZXJyKSB7DQogICAgICBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyKG5hbWUsIHJlc29sdmVyKTsNCiAgICAgIHJlamVjdChlcnIpOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlc29sdmVyKCkgew0KICAgICAgaWYgKHR5cGVvZiBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGVtaXR0ZXIucmVtb3ZlTGlzdGVuZXIoJ2Vycm9yJywgZXJyb3JMaXN0ZW5lcik7DQogICAgICB9DQogICAgICByZXNvbHZlKFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7DQogICAgfTsNCg0KICAgIGV2ZW50VGFyZ2V0QWdub3N0aWNBZGRMaXN0ZW5lcihlbWl0dGVyLCBuYW1lLCByZXNvbHZlciwgeyBvbmNlOiB0cnVlIH0pOw0KICAgIGlmIChuYW1lICE9PSAnZXJyb3InKSB7DQogICAgICBhZGRFcnJvckhhbmRsZXJJZkV2ZW50RW1pdHRlcihlbWl0dGVyLCBlcnJvckxpc3RlbmVyLCB7IG9uY2U6IHRydWUgfSk7DQogICAgfQ0KICB9KTsNCn0NCg0KZnVuY3Rpb24gYWRkRXJyb3JIYW5kbGVySWZFdmVudEVtaXR0ZXIoZW1pdHRlciwgaGFuZGxlciwgZmxhZ3MpIHsNCiAgaWYgKHR5cGVvZiBlbWl0dGVyLm9uID09PSAnZnVuY3Rpb24nKSB7DQogICAgZXZlbnRUYXJnZXRBZ25vc3RpY0FkZExpc3RlbmVyKGVtaXR0ZXIsICdlcnJvcicsIGhhbmRsZXIsIGZsYWdzKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBldmVudFRhcmdldEFnbm9zdGljQWRkTGlzdGVuZXIoZW1pdHRlciwgbmFtZSwgbGlzdGVuZXIsIGZsYWdzKSB7DQogIGlmICh0eXBlb2YgZW1pdHRlci5vbiA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIGlmIChmbGFncy5vbmNlKSB7DQogICAgICBlbWl0dGVyLm9uY2UobmFtZSwgbGlzdGVuZXIpOw0KICAgIH0gZWxzZSB7DQogICAgICBlbWl0dGVyLm9uKG5hbWUsIGxpc3RlbmVyKTsNCiAgICB9DQogIH0gZWxzZSBpZiAodHlwZW9mIGVtaXR0ZXIuYWRkRXZlbnRMaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykgew0KICAgIC8vIEV2ZW50VGFyZ2V0IGRvZXMgbm90IGhhdmUgYGVycm9yYCBldmVudCBzZW1hbnRpY3MgbGlrZSBOb2RlDQogICAgLy8gRXZlbnRFbWl0dGVycywgd2UgZG8gbm90IGxpc3RlbiBmb3IgYGVycm9yYCBldmVudHMgaGVyZS4NCiAgICBlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgZnVuY3Rpb24gd3JhcExpc3RlbmVyKGFyZykgew0KICAgICAgLy8gSUUgZG9lcyBub3QgaGF2ZSBidWlsdGluIGB7IG9uY2U6IHRydWUgfWAgc3VwcG9ydCBzbyB3ZQ0KICAgICAgLy8gaGF2ZSB0byBkbyBpdCBtYW51YWxseS4NCiAgICAgIGlmIChmbGFncy5vbmNlKSB7DQogICAgICAgIGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCB3cmFwTGlzdGVuZXIpOw0KICAgICAgfQ0KICAgICAgbGlzdGVuZXIoYXJnKTsNCiAgICB9KTsNCiAgfSBlbHNlIHsNCiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgImVtaXR0ZXIiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBFdmVudEVtaXR0ZXIuIFJlY2VpdmVkIHR5cGUgJyArIHR5cGVvZiBlbWl0dGVyKTsNCiAgfQ0KfQ=="));
